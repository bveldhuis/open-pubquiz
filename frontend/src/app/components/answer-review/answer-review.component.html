@if (question) {
  <div class="answer-review quiz-component-card">
    <div class="review-header">
      <h2>Question {{ question.question_number }}: {{ question.question_text }}</h2>
      <div class="question-summary">
        <span class="question-type-badge">{{ getQuestionTypeLabel(question.type) }}</span>
        <span class="points">{{ question.points }} point{{ question.points !== 1 ? 's' : '' }}</span>
      </div>
    </div>
    <!-- Show correct answer for reference -->
    @if (question.correct_answer || (question.type === 'numerical' && question.numerical_answer !== null) || (question.type === 'sequence' && question.sequence_items)) {
      <div class="correct-answer-reference">
        <mat-icon>check_circle</mat-icon>
        <span><strong>Correct Answer:</strong> {{ getFormattedCorrectAnswer() }}</span>
      </div>
    }
    <div class="answers-section">
      <h3>Team Answers ({{ answers.length }})</h3>
      <!-- Loading state -->
      @if (isLoading) {
        <app-loading-state message="Loading answers..."></app-loading-state>
      }
      <!-- No answers state -->
      @if (!isLoading && answers.length === 0) {
        <app-no-content-state
          icon="info"
          message="No answers received for this question yet.">
        </app-no-content-state>
      }
      @if (!isLoading && answers.length > 0) {
        <div class="answers-list">
          @for (answer of answers; track answer) {
            <div class="answer-item">
              <div class="answer-header">
                <div class="team-info">
                  <mat-icon>group</mat-icon>
                  <span class="team-name">{{ answer.team?.name || 'Unknown Team' }}</span>
                </div>
                <div class="answer-status">
                  <!-- Manual scoring display -->
                  @if (editingAnswerId === answer.id) {
                    <div class="manual-scoring-display">
                      <mat-form-field appearance="outline" class="points-input">
                        <mat-label>Points</mat-label>
                        <input
                          matInput
                          type="number"
                          [min]="0"
                          [max]="question.points"
                          [(ngModel)]="editingPoints"
                          (keyup.enter)="saveManualScore(answer.id)"
                          (blur)="saveManualScore(answer.id)">
                          <mat-hint>/ {{ question.points }} max</mat-hint>
                        </mat-form-field>
                        <button
                          mat-icon-button
                          color="primary"
                          (click)="saveManualScore(answer.id)"
                          matTooltip="Save points">
                          <mat-icon>check</mat-icon>
                        </button>
                        <button
                          mat-icon-button
                          color="warn"
                          (click)="cancelManualScore()"
                          matTooltip="Cancel">
                          <mat-icon>close</mat-icon>
                        </button>
                      </div>
                    }
                    <!-- Regular points display -->
                    @if (editingAnswerId !== answer.id) {
                      <div class="points-display-container">
                        <span class="points-display" [class.correct]="answer.is_correct" [class.incorrect]="answer.is_correct === false">
                          {{ answer.points_awarded }} / {{ question.points }} pts
                        </span>
                        <button
                          mat-icon-button
                          color="accent"
                          (click)="startManualScore(answer)"
                          matTooltip="Edit points manually"
                          class="edit-points-btn">
                          <mat-icon>edit</mat-icon>
                        </button>
                      </div>
                    }
                    @if (answer.is_correct) {
                      <mat-icon class="status-icon correct">check_circle</mat-icon>
                    }
                    @if (answer.is_correct === false) {
                      <mat-icon class="status-icon incorrect">cancel</mat-icon>
                    }
                    @if (answer.is_correct === undefined) {
                      <mat-icon class="status-icon pending">pending</mat-icon>
                    }
                  </div>
                </div>
                <div class="answer-content">
                  <div class="answer-text">
                    <strong>Answer:</strong>
                    @if (question.type === 'sequence') {
                      <span>{{ getSequenceAnswerText(answer) }}</span>
                    }
                    @if (question.type !== 'sequence') {
                      <span>{{ answer.answer_text }}</span>
                    }
                  </div>
                  <!-- Quick scoring buttons for open text questions -->
                  @if (question.type === 'open_text' && answer.is_correct === undefined) {
                    <div class="scoring-section">
                      <div class="scoring-controls">
                        <button
                          mat-icon-button
                          color="primary"
                          (click)="onScoreAnswer(answer.id, question.points, true)"
                          matTooltip="Mark as correct">
                          <mat-icon>check_circle</mat-icon>
                        </button>
                        <button
                          mat-icon-button
                          color="warn"
                          (click)="onScoreAnswer(answer.id, 0, false)"
                          matTooltip="Mark as incorrect">
                          <mat-icon>cancel</mat-icon>
                        </button>
                        <button
                          mat-icon-button
                          color="accent"
                          (click)="onScorePartial(answer.id)"
                          matTooltip="Award partial points">
                          <mat-icon>star_half</mat-icon>
                        </button>
                      </div>
                    </div>
                  }
                  <!-- Auto-scored questions with manual override option -->
                  @if (isAutoScoredQuestion()) {
                    <div class="auto-scored">
                      <span class="auto-label">Auto-scored</span>
                      <span class="result" [class.correct]="answer.is_correct" [class.incorrect]="answer.is_correct === false">
                        {{ getAutoScoreResultText(answer) }}
                      </span>
                      <button
                        mat-stroked-button
                        color="accent"
                        (click)="startManualScore(answer)"
                        class="override-btn">
                        <mat-icon>edit</mat-icon>
                        Override Score
                      </button>
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        }
      </div>
      <div class="button-group">
        @if (isLastQuestion) {
          <button
            mat-raised-button
            color="primary"
            (click)="showLeaderboard.emit()"
            [disabled]="hasUnscoredAnswers"
            >
            <mat-icon>leaderboard</mat-icon>
            Show Leaderboard
          </button>
        }
        @if (!isLastQuestion) {
          <button
            mat-raised-button
            color="accent"
            (click)="nextQuestion.emit()"
            [disabled]="hasUnscoredAnswers"
            >
            <mat-icon>arrow_forward</mat-icon>
            Next Question
          </button>
        }
      </div>
    </div>
  }
